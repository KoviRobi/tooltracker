[Unit]
After=network.target
Description=Tooltracker daemon

[Service]
Environment="PATH=/opt/tooltracker/bin"
DynamicUser=true
Group=tooltracker
User=tooltracker
AmbientCapabilities=CAP_NET_BIND_SERVICE
ExecStart="{{ tooltracker['install_path'] }}/tooltracker" \
  {{ '-listen %r' % tooltracker['listen'] if tooltracker['listen'] }} \
  {{ '-domain %r' % tooltracker['domain'] if tooltracker['domain'] }} \
  {{ '-smtp %d' % tooltracker['smtp_port'] }} \
  {{ '-http %d' % tooltracker['http_port'] }} \
  {{ '-http-prefix %r' % ('/' + tooltracker['http_prefix']) if tooltracker['http_prefix'] }} \
  {{ '-from %r' % tooltracker['from_re'] if tooltracker['from_re'] }} \
  {{ '-to %r' % tooltracker['to_user'] if tooltracker['to_user'] }} \
  {{ '-db %r' % tooltracker['db_path'] if tooltracker['db_path'] }} \
  {{ '-dkim %r' % tooltracker['dkim'] if tooltracker['dkim'] }}
StateDirectory=tooltracker
WorkingDirectory=%S/tooltracker

[Install]
WantedBy=multi-user.target
